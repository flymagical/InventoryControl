@model InventoryControl.Models.Components.PaginatedList<InventoryControl.Data.Views.vw_AprioriBidang>
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    ViewData["Title"] = "Proses Apriori";
    Layout = "~/Views/Shared/_MainLayout.cshtml";
}

<h1><i class="fa fa-cog fa-spin"></i> @ViewData["Title"]</h1>

<div class="card">
    <div class="card-body">
        <div class="card-form">
            <div class="card-label _20">Min Support </div>
            <div class="form-control _80">
                : <input type="text" id="txt-minsupport" value="2"/>
            </div>
        </div>
        <div class="card-form">
            <div class="card-label _20">Min Confidence </div>
            <div class="form-control _80">
                : <input type="text" id="txt-minconfidence" value="60"/>
            </div>
        </div>
        <div class="card-form">
            <div class="card-label _20">Bidang </div>
            <div class="form-control _80">
                : @Html.DropDownList("KdOrg", new SelectList(ViewBag.SelectBidang, "Id", "Nama"))
            </div>
        </div>
        <div class="card-form">
            <div class="card-label _20"></div>
            <div class="card-label _80">
                <button type="button" class="btn btn-info" id="btn-proses">Proses Dengan Apriori</button>
            </div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <table id="tbl-support">
            <thead>
                <tr>
                    <th>Bidang</th>
                    <th>Tanggal Di-generate</th>
                    <th>Daftar Barang</th>
                    <th>Label</th>
                    <th>Support</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.OrderByDescending(x => x.Label))
                {
                    <tr>
                        <td style="width:20%;" class="_center">@item.Nama</td>
                        <td style="width:10%;" class="_center">@item.StrCreatedDate</td>
                        <td style="width:50%;">@item.ItemList</td>
                        <td style="width:10%;">@item.Label</td>
                        <td style="width:10%;">@item.Support</td>
                    </tr>
                }
            </tbody>
            
        </table>
    </div>
</div>

@section Styles{
    <style>
        .card-form {
            display: flex;
            margin-bottom: 10px;
        }

        ._20 {
            width: 20%;
        }

        .form-control {
            display: block;
            width: 100%;
        }

        .btn {
            height: 40px;
            color: #ffffff;
            background-color: #86134c;
            padding: 5px 10px 5px 10px;
            border-color: #86134c;
            border-radius: 25px;
        }

        .pager {
            margin-top: 40px;
        }

        .devider {
            margin-left: 20px;
        }
    </style>
}

@section Scripts{
    <script type="text/javascript">

        $("#btn-proses").click(function () {
            var minsupport = $("#txt-minsupport").val();
            var minconfidence = $("#txt-minconfidence").val();
            var kdOrg = $("#KdOrg").val();

            console.log(minsupport);
            if (minsupport == null || minsupport == "" || minconfidence == null || minconfidence == "" || kdOrg == null || kdOrg == "") {
                alert("Minimum Support, Minimum Confidence, dan Bidang harus diisi!");
            } else {
                console.log("Silakan tunggu...........");
                //showLoadPanel();
                showBusyIndicator("body");
                $.ajax({
                    url: '/INV/ApiApriori/ProsesApriori/',
                    method: "POST",
                    data:
                    {
                        minsupport: minsupport,
                        minconfidence: minconfidence,
                        kdOrg: kdOrg,
                        isForce: true
                    }
                })
                .done(function (result) {
                    stopBusyIndicator();
                    console.log(result);
                    $("#tbl-support tbody").html("");
                    result.forEach(function (item) {
                        
                        $("#tbl-support").append("<tr><td>" + $("#KdOrg option:selected").text() + "</td><td>" + item.startDate + "</td><td>" + item.itemList + "</td><td>" + item.label + "</td><td>" + item.support + "</td></tr>");
                    })
                });
            }

        });

        $("#@ViewBag.ActiveClass").addClass("active");


    </script>
}